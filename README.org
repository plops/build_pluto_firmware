- try to build pluto fpga firmware and linux on fedora 32
- https://wiki.analog.com/resources/fpga/docs/releases
#+begin_example
master	        Quartus 18.1	Vivado 2019.1	Release Notes	master
hdl_2019_r1	Quartus 18.1	Vivado 2018.3	Release Notes	2019_r1 (*)
hdl_2018_r2	Quartus 18.0	Vivado 2018.2	Release Notes	2018_r2
hdl_2018_r1	Quartus 17.1.1	Vivado 2017.4.1	Release Notes	2018_r1
hdl_2017_r1	Quartus 16.1	Vivado 2016.4	Release Notes	2017_r1
hdl_2016_r2	Quartus 16.0	Vivado 2016.2	Release Notes	2016_r2
hdl_2016_r1	Quartus 15.1	Vivado 2015.4.2	Release Notes	2016_r1
hdl_2015_r2	Quartus 15.0.2	Vivado 2015.2	Release Notes	2015_r2
hdl_2015_r1	Quartus 14.1	Vivado 2014.4.1	Release Notes	2015_r1
hdl_2014_r2	Quartus 14.0	Vivado 2014.2	Release Notes	2014_r2
hdl_2014_r1	Quartus 14.0	Vivado 2013.4	Release Notes	2014_r1
#+end_example 

- i need to get vivado 2018.3

- to install:
#+begin_example
[martin@localhost pluto]$ cat /etc/os-release
#NAME=Fedora
NAME=Ubuntu
#VERSION="32 (Thirty Two)"
VERSION="18.04.4 LTS (Bionic Beaver)" 
#+end_example

- build fpga bitstream

#+begin_example
git clone https://github.com/analogdevicesinc/hdl/
git checkout    remotes/origin/hdl_2019_r1

#+end_example



- export ADI_USE_OOC_SYNTHESIS=y
  - is will synthesize each IP from the block design individually and
    will store it in a common cache for future re-use

- build firmware
- https://wiki.analog.com/university/tools/pluto/obtaining_the_sources
#+begin_example
git clone --recursive https://github.com/analogdevicesinc/plutosdr-fw.git
#git clone https://github.com/analogdevicesinc/plutosdr-fw/
#git submodule update --init --recursive
#cd hdl
#git checkout    remotes/origin/hdl_2019_r1
#cd ../linux
#git checkout remotes/origin/2019_R1
dnf  install ccache dfu-util fakeroot help2man rsync cpio file \
             bison flex uboot-tools ncurses-compat-libs patch \
	     perl-ExtUtils-MakeMaker
#+end_example 
- https://wiki.analog.com/university/tools/pluto/building_the_image 

#+begin_example
  HOSTLD  scripts/dtc/dtc
/usr/bin/ld: scripts/dtc/dtc-parser.tab.o:(.bss+0x10): multiple definition of `yylloc'; scripts/dtc/dtc-lexer.lex.o:(.bss+0x0): first defined here
collect2: error: ld returned 1 exit status
#+end_example
- https://www.reddit.com/r/LineageOS/comments/hkq8ah/multiple_definitions_error_in_dtc_tool_when/
#+begin_example
comment out linux/scripts/dtc/dtc-lexer.l 
YYLTYPE yylloc;
#+end_example
 
- make sure the current cwd is not in LD_LIBRARY_PATH


- it seems like the current plutosdr-fw needs VIVADO_VERSION ?= 2019.1

- someone else compiling pluto:
https://manual.hnap.de/building_the_fw/
https://hamnetdb.net/map.cgi
https://hnap.de/assets/pdf/Masterthesis%20-%20Design%20of%20a%20Radio%20Communications%20Protocol%20for%20HAMNET%20Access%20in%20the%2070cm%20Amateur%20Radio%20Band.pdf

#+begin_example
make -C buildroot ARCH=arm zynq_pluto_defconfig
make -C buildroot ARCH=arm menuconfig
/
headers_4_9 
2 # (external)
enter

Toolchain->gcc 7.x

# i also enabled tcpdump and gdb
# next time i might want to add strace as well

# overwrite original config
make -C buildroot savedefconfig
#+end_example
 
- how to boot from a fresh build
https://wiki.analog.com/university/tools/pluto/devs/reboot

- updating firmware according to usb standard (in case the normal firmware update fails)
https://wiki.analog.com/university/tools/pluto/users/firmware#dfu_update

- before new firmware:
#+begin_example

[root@localhost pluto_hdl]# ssh 192.168.2.1
root@192.168.2.1's password: 
Welcome to:
______ _       _        _________________
| ___ \ |     | |      /  ___|  _  \ ___ \
| |_/ / |_   _| |_ ___ \ `--.| | | | |_/ /
|  __/| | | | | __/ _ \ `--. \ | | |    /
| |   | | |_| | || (_) /\__/ / |/ /| |\ \
\_|   |_|\__,_|\__\___/\____/|___/ \_| \_|

v0.31
http://wiki.analog.com/university/tools/pluto
# uname -ab2/191127_
Linux pluto 4.14.0-42540-g387d584 #301 SMP PREEMPT Wed Jul 3 15:06:53 CEST 2019 armv7l GNU/Linux
# fw_printenv fit_config
fit_config=config@9

# index.html on mass storage

Model 	Analog Devices PlutoSDR Rev.B (Z7010-AD9364)
Serial 	104400b83991000b0d000f00bbd8642eff
Build 	v0.31
Linux 	Linux pluto 4.14.0-42540-g387d584 #301 SMP PREEMPT Wed Jul 3 15:06:53 CEST 2019 armv7l GNU-Linux;1 core(s)
U-Boot 	U-Boot PlutoSDR v0.20-PlutoSDR-00043-gefdb9e8 (Dec 18 2017 - 18:25:09 +0100)
FPGA 	2018_r2-20-g28df75
Root FS 	2019.02.2-388-gb31cc4
IIO 	Library version: 0.18 (git tag: v0.18)
Back to top

Standalone Applications:

Custom C/C++ applications can be created/compiled on a host with a Linaro GNU Compiler Collection (GCC) toolchain (with the appropriate flags), transferred over and run directly on the PlutoSDR.
GCC Compiler Target Triple 	arm-linux-gnueabihf
GCC version 	Linaro GCC 7.2-2017.11-rc1 7.2.1 20171011
Binutils version 	Linaro_Binutils- 2.29.1.20171214
SysRoot 	Old Sysroot for firmware v0.31 (please upgrade firmware to v0.32)
#+end_example

- gnss receiver https://github.com/oscimp/oscimpDigital/wiki


- start to update firmware
https://wiki.analog.com/university/tools/pluto/users/firmware

- Copy the pluto.frm file onto the mass storage device, and
  then eject it. LED1 will start blinking rapidly.

- WAIT 4 minutes for firmware to update
- i started at 21:31
